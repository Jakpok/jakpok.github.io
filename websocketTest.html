<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
	<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		
        <title>WebSockets</title>
    </head>
    <body>
		<div style="padding:40px">
			<input type="text" name="ip" id="ip" value="echo.websocket.org"/>
			<input type="text" name="port" id="port" value="80"/>
			<a class="ui-btn button" onclick="connect()">Connect</a>
			<br><hr><br>
			<input type="text" name="msg" id="msg" value="Your message"/>
			<a class="ui-btn button" onclick="send()">Send</a>
			<p>Otrzymane wiadomosci:</p>
			<textarea style="width:100%;overflow-y:scroll;resize:none"></textarea>
			<br><hr><br>
			<a class="ui-btn button" onclick="disconnect()">Disconnect</a>
		</div>
		<script>
			var socket;
			function connect(){
				$("textarea").css("height", "150px");
				var ip = $('#ip').val();
				var port = $('#port').val();
				console.log(ip + ":"  + port);
				socket = new WebSocket("ws://" + ip + ":" + port +"/");
				console.log("Connecting...");
				socket.onopen = function(event){
					// Web Socket is connected, send data using send()
					socket.send("Hello!");
					alert("Polaczono (onOpen). Wiadomosc powitalna wyslana");
				};

				socket.onmessage = function (evt) { 
					var received_msg = evt.data;
					console.log(received_msg);
					$("textarea").append("Otrzymano: "+ received_msg + "\n");
					
				};

				socket.onclose = function(){ 
					// websocket is closed.
					alert("Connection is closed!"); 
					$("textarea").val(" ");
				};
				socket.onerror = function (event) {
					alert("Error: " + event); 
				};
			}
			function send(){
				var msg = $('#msg').val();
				socket.send(msg);
				console.log("Sending msg: " + msg);
			}
			function disconnect(){
				socket.close();				
			}
		</script>
    </body>
</html>
